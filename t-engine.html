<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-Engine - Debear Party</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        /* ========== å…¨å±€æ ·å¼ ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ä¼˜åŒ–é¢œè‰²ç³»ç»Ÿ */
            --primary-gradient: linear-gradient(135deg, #00c4ef 0%, #e900e9 100%);
            --secondary-gradient: linear-gradient(135deg, #4dd0e1 0%, #d91e5a 100%);
            --neon-cyan: #00c4ef;
            --neon-pink: #e900e9;
            --neon-magenta: #d91e5a;
            --dark-bg: #0a0e1a;
            --dark-surface: #1a0a2e;
            --dark-purple: #2d1b4e;
            --text-primary: #ffffff;
            --text-secondary: #a0b1d4;
            --grid-color: rgba(0, 196, 239, 0.12);
            
            /* z-index å±‚çº§ */
            --z-background: -1;
            --z-navbar: 100;
            --z-mobile-menu-overlay: 110;
            --z-mobile-menu: 120;
            --z-hamburger: 130;
            --z-toast: 200;
            --z-modal: 300;
            
            /* é—´è·ç³»ç»Ÿ */
            --spacing-xs: 8px;
            --spacing-sm: 16px;
            --spacing-md: 24px;
            --spacing-lg: 32px;
            --spacing-xl: 40px;
            --spacing-2xl: 48px;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* ========== ç²’å­èƒŒæ™¯ ========== */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            background: 
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px),
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                radial-gradient(ellipse at top, #2d1b4e 0%, #1a0a2e 50%, #0a0e1a 100%);
            background-size: 50px 50px, 50px 50px, 100% 100%;
            background-position: 0 0, 0 0, center center;
        }

        #particles-js::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 212, 255, 0.03) 0px,
                transparent 2px,
                transparent 4px
            );
            pointer-events: none;
            animation: scan 8s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(50px); }
        }

        /* ========== å¯¼èˆªæ  ========== */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            padding: 20px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(10, 14, 26, 0.7);
            backdrop-filter: blur(20px);
            border-bottom: 2px solid rgba(0, 212, 255, 0.2);
            box-shadow: 0 4px 30px rgba(0, 212, 255, 0.05);
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        /* å¯¼èˆªèœå• */
        .nav-menu {
            display: flex;
            gap: 40px;
            list-style: none;
            align-items: center;
        }

        .nav-menu a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            position: relative;
            padding: 8px 0;
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            color: var(--neon-cyan);
            text-shadow: 0 0 8px rgba(0, 196, 239, 0.6);
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-gradient);
            transition: width 0.3s;
        }

        .nav-menu a:hover::after,
        .nav-menu a.active::after {
            width: 100%;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-back, .mobile-back {
            padding: 10px 25px;
            background: transparent;
            border: 2px solid var(--neon-cyan);
            border-radius: 20px;
            color: var(--neon-cyan);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-back:hover, .mobile-back:hover {
            background: var(--neon-cyan);
            color: white;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
        }

        .mobile-back {
            display: none;
            font-size: 20px;
        }

        .connect-btn {
            padding: 12px 30px;
            background: var(--primary-gradient);
            border: 2px solid transparent;
            border-radius: 25px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.5);
        }

        .connect-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(0, 212, 255, 0.7);
        }

        .hamburger {
            display: none;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            padding: 10px;
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: var(--primary-gradient);
            border-radius: 2px;
            transition: all 0.3s;
        }

        /* ========== ç§»åŠ¨ç«¯èœå• ========== */
        .mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 998;
        }

        .mobile-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 280px;
            height: 100vh;
            background: rgba(10, 14, 26, 0.98);
            backdrop-filter: blur(20px);
            border-left: 2px solid rgba(0, 212, 255, 0.3);
            padding: 80px 30px 30px;
            transition: right 0.4s ease;
            z-index: 999;
        }

        .mobile-menu.active {
            right: 0;
        }

        .mobile-nav-links {
            list-style: none;
        }

        .mobile-nav-links li {
            margin: 20px 0;
        }

        .mobile-nav-links a, .mobile-nav-links button {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 18px;
            font-weight: 600;
            display: block;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
            transition: all 0.3s;
            background: transparent;
            border: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
        }

        .mobile-nav-links a:hover,
        .mobile-nav-links a.active,
        .mobile-nav-links button:hover {
            color: var(--neon-cyan);
            padding-left: 10px;
        }

        .mobile-connect-btn {
            width: 100%;
            margin-top: 30px;
        }

        /* ========== ä¸»å®¹å™¨ ========== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 120px 5% 80px;
        }

        .page-title {
            text-align: center;
            margin-bottom: 60px;
        }

        .page-title h1 {
            font-size: 56px;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 30px rgba(0, 212, 255, 0.4));
        }

        .page-title p {
            font-size: 20px;
            color: var(--text-secondary);
        }

        /* ========== é€‰é¡¹å¡ ========== */
        .tabs {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 50px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 15px 40px;
            background: transparent;
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 25px;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .tab-btn.active {
            background: var(--primary-gradient);
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 30px rgba(0, 212, 255, 0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== ä»‹ç»åŒºåŸŸ ========== */
        .intro-section {
            max-width: 1000px;
            margin: 0 auto 60px;
        }

        .intro-card {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.08) 0%, rgba(255, 0, 255, 0.08) 100%);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            transition: all 0.3s;
        }

        .intro-card:hover {
            border-color: var(--neon-pink);
            box-shadow: 0 20px 60px rgba(255, 0, 255, 0.3);
        }

        .intro-card h2 {
            font-size: 32px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        .intro-card p {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .feature-item {
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
        }

        .feature-item:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--neon-cyan);
            transform: translateY(-5px);
        }

        .feature-item .icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .feature-item h3 {
            font-size: 20px;
            color: var(--neon-cyan);
            margin-bottom: 10px;
        }

        .feature-item p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* ========== æŒ–çŸ¿åŒºåŸŸ ========== */
        .mining-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .mining-card {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.08) 0%, rgba(255, 0, 255, 0.08) 100%);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
        }

        .mining-card h3 {
            font-size: 28px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 25px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 25px;
        }

        .alert.info {
            background: rgba(0, 212, 255, 0.15);
            border: 2px solid rgba(0, 212, 255, 0.5);
            color: var(--neon-cyan);
        }

        .alert.success {
            background: rgba(0, 255, 136, 0.15);
            border: 2px solid rgba(0, 255, 136, 0.5);
            color: #00ff88;
        }

        .alert.error {
            background: rgba(255, 0, 100, 0.15);
            border: 2px solid rgba(255, 0, 100, 0.5);
            color: #ff0064;
        }

        .reward-box {
            background: var(--primary-gradient);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin: 25px 0;
        }

        .reward-amount {
            font-size: 48px;
            font-weight: 900;
            margin: 10px 0;
        }

        .reward-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .input-group {
            margin: 25px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 212, 255, 0.05);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .stat {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        }

        .stat:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: var(--text-secondary);
        }

        .stat-value {
            font-weight: 700;
            color: white;
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: var(--primary-gradient);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 30px rgba(0, 212, 255, 0.4);
            margin-bottom: 15px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 212, 255, 0.6);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .btn-secondary:hover {
            background: var(--neon-cyan);
            color: white;
        }

        /* ========== æ¶ˆæ¯æç¤º ========== */
        #message {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9998;
            width: 90%;
            max-width: 600px;
        }

        /* ========== å“åº”å¼ ========== */
        @media (max-width: 768px) {
            .page-title h1 { font-size: 36px; }
            .nav-menu { display: none; }
            .nav-back { display: none; }
            .navbar .connect-btn { display: none; }
            .hamburger { display: flex; }
            .mobile-back { display: flex; }
            .mobile-connect-btn { display: block; }
            .mining-card { padding: 25px; }
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <a href="index.html" class="logo">ğŸ» Debear Party</a>
        <ul class="nav-menu">
            <li><a href="index.html">é¦–é¡µ</a></li>
            <li><a href="swap.html">Swap</a></li>
            <li><a href="pass-nft.html">Pass NFT</a></li>
            <li><a href="t-engine.html" class="active">T-Engine</a></li>
            <li><a href="gamefi.html">GameFi</a></li>
        </ul>
        <div class="nav-buttons">
            <button class="connect-btn" id="connectBtn" onclick="connectWallet()">è¿æ¥é’±åŒ…</button>
            <button class="hamburger" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- æ¶ˆæ¯æç¤ºæ¡† -->
    <div id="message"></div>

    <!-- ç§»åŠ¨ç«¯èœå•é®ç½© -->
    <div class="mobile-menu-overlay" onclick="toggleMobileMenu()"></div>

    <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ èœå• -->
    <div class="mobile-menu">
        <ul class="mobile-nav-links">
            <li><a href="index.html">é¦–é¡µ</a></li>
            <li><a href="swap.html">Swap</a></li>
            <li><a href="pass-nft.html">Pass NFT</a></li>
            <li><a href="t-engine.html" class="active">T-Engine</a></li>
            <li><a href="gamefi.html">GameFi</a></li>
        </ul>
        <button class="connect-btn mobile-connect-btn" onclick="connectWallet()">è¿æ¥é’±åŒ…</button>
    </div>

    <!-- ä¸»å†…å®¹ -->
    <div class="container">
        <div class="page-title">
            <h1>âš™ï¸ T-Engine</h1>
            <p>è´¨æŠ¼æŒ–çŸ¿ç³»ç»Ÿ - æŒç»­è·å¾— DP Token å¥–åŠ±</p>
        </div>

        <!-- 1. T-Engine è´¨æŠ¼æŒ–çŸ¿ï¼ˆæ•´åˆçª—å£ï¼‰ -->
        <div class="mining-container">
            <div class="mining-card" style="position: relative;">
                <!-- å€’è®¡æ—¶ç½®å³ä¸Šè§’ -->
                <div style="position: absolute; top: 20px; right: 20px; padding: 10px 20px; background: rgba(0, 212, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 12px; text-align: center;">
                    <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 4px;">ğŸ—“ï¸ ä¸‹æ¬¡é‡Šæ”¾</div>
                    <div id="tengineNextRelease" style="font-size: 18px; font-weight: 700; color: var(--neon-cyan); text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);">--:--:--</div>
                </div>
                
                <h3>âš™ï¸ T-Engine è´¨æŠ¼æŒ–çŸ¿</h3>
                
                <!-- å¥–åŠ±æ˜¾ç¤ºåŒºåŸŸ -->
                <div class="reward-box" style="margin-bottom: 20px;">
                    <div class="reward-label">å¾…é¢†å–å¥–åŠ±</div>
                    <div class="reward-amount" id="pendingReward">0.0000</div>
                    <div class="reward-label">DP Token</div>
                </div>
                
                <button class="btn-primary" onclick="claimReward()" style="margin-bottom: 25px;">é¢†å–å¥–åŠ±</button>
                
                <!-- æŒ–çŸ¿æ•°æ® -->
                <div style="margin: 25px 0;">
                    <div class="stat">
                        <span class="stat-label">å…¨ç½‘è´¨æŠ¼æ€»é‡:</span>
                        <span class="stat-value" id="totalStake">0 DP</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">æˆ‘çš„å‰©ä½™ä»½é¢:</span>
                        <span class="stat-value" id="myRemaining">0 DP</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">æˆ‘çš„è´¨æŠ¼:</span>
                        <span class="stat-value" id="myStake">0 DP</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">ç´¯è®¡é¢†å–:</span>
                        <span class="stat-value" id="totalClaimed">0 DP</span>
                    </div>
                </div>
                
                <!-- åˆ†éš”çº¿ -->
                <div style="border-top: 2px solid rgba(0, 212, 255, 0.2); margin: 25px 0;"></div>
                
                <!-- è´¨æŠ¼åŒºåŸŸ -->
                <div class="input-group">
                    <label style="display: flex; justify-content: space-between; align-items: center;">
                        <span>è´¨æŠ¼æ•°é‡ (DP Token)</span>
                        <span style="color: var(--neon-cyan); font-size: 14px;">ä½™é¢: <span id="userDPBalance">0.00</span> DP</span>
                    </label>
                    <div style="position: relative;">
                        <input type="text" id="stakeAmount" placeholder="è¾“å…¥è´¨æŠ¼æ•°é‡" style="padding-right: 70px;">
                        <button onclick="setMaxAmount()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); padding: 6px 15px; background: var(--neon-cyan); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.3s;">MAX</button>
                    </div>
                </div>

                <button class="btn-primary" onclick="stake()">è´¨æŠ¼æŒ–çŸ¿</button>
            </div>
        </div>

        <!-- 2. ä»€ä¹ˆæ˜¯ T-Engine -->
        <div class="intro-section">
            <div class="intro-card">
                <h2>ğŸš€ ä»€ä¹ˆæ˜¯ T-Engineï¼Ÿ</h2>
                <p>
                    T-Engine æ˜¯ Debear Party ç”Ÿæ€ç³»ç»Ÿçš„æ ¸å¿ƒæŒ–çŸ¿å¼•æ“ã€‚é€šè¿‡è´¨æŠ¼ DP Tokenï¼Œç”¨æˆ·å¯ä»¥å¯åŠ¨ T-Engine è¿›è¡ŒæŒç»­æŒ–çŸ¿ï¼Œè·å¾—ä¸°åšçš„ DP Token å¥–åŠ±ã€‚
                </p>
                <p>
                    T-Engine çš„é‡Šæ”¾æœºåˆ¶ä¸ºï¼Œæ¯å¤©é‡Šæ”¾å‰©ä½™ä»½é¢çš„0.3%ï¼Œç¡®ä¿å…¬å¹³åˆ†é…å’Œå¯æŒç»­å‘å±•ã€‚æ— è®ºæ‚¨æ˜¯å°é¢è´¨æŠ¼è¿˜æ˜¯å¤§é¢æŠ•èµ„ï¼Œéƒ½èƒ½è·å¾—ç›¸åº”çš„æ”¶ç›Šå›æŠ¥ã€‚
                </p>
            </div>
        </div>

        <!-- 3. å¦‚ä½•ä½¿ç”¨ -->
        <div class="intro-section">
            <div class="intro-card">
                <h2>ğŸ”„ å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h2>
                <ol style="color: var(--text-secondary); margin-left: 20px; line-height: 2;">
                    <li><strong>è¿æ¥é’±åŒ…ï¼š</strong>ç¡®ä¿é’±åŒ…ä¸­æœ‰è¶³å¤Ÿçš„ DP Token</li>
                    <li><strong>è´¨æŠ¼ä»£å¸ï¼š</strong>è¾“å…¥è´¨æŠ¼æ•°é‡ï¼Œç‚¹å‡»"è´¨æŠ¼æŒ–çŸ¿"æŒ‰é’®</li>
                    <li><strong>å¼€å§‹æŒ–çŸ¿ï¼š</strong>è´¨æŠ¼æˆåŠŸåï¼ŒT-Engine è‡ªåŠ¨å¯åŠ¨</li>
                    <li><strong>é¢†å–å¥–åŠ±ï¼š</strong>æ¯å¤©å¯é¢†å–å‰©ä½™ä»½é¢çš„0.3%ï¼Œé¢†å–æ—¶æ‰£10%ç¨</li>
                    <li><strong>æŒç»­æ”¶ç›Šï¼š</strong>å»ºè®®å®šæœŸé¢†å–å¥–åŠ±å¹¶å¤æŠ•ï¼Œè·å¾—æ›´é«˜æ”¶ç›Š</li>
                </ol>
            </div>
        </div>

        <!-- 4. æ³¨æ„äº‹é¡¹ -->
        <div class="intro-section">
            <div class="intro-card">
                <h2>âš ï¸ æ³¨æ„äº‹é¡¹</h2>
                <ul style="color: var(--text-secondary); margin-left: 20px; line-height: 2;">
                    <li>è´¨æŠ¼æ“ä½œéœ€è¦æ”¯ä»˜å°‘é‡ Gas è´¹ç”¨ï¼ˆBERAï¼‰</li>
                    <li>T-Engine ä¸æ”¯æŒå–å›è´¨æŠ¼ï¼Œä»…èƒ½é¢†å–æ¯æ—¥é‡Šæ”¾çš„å¥–åŠ±</li>
                    <li>æŒæœ‰ Pass NFT å¯è·å¾—ç®—åŠ›åŠ æˆï¼ˆå³å°†å¼€æ”¾ï¼‰</li>
                    <li>æ™ºèƒ½åˆçº¦å·²ç»è¿‡å®‰å…¨å®¡è®¡ï¼Œä½†ä»éœ€è°¨æ…æŠ•èµ„</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ç²’å­æ•ˆæœåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    
    <script>
        // ========== ç²’å­èƒŒæ™¯é…ç½® ==========
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: ['#00d4ff', '#ff00ff'] },
                shape: { type: 'circle' },
                opacity: { value: 0.6, random: true },
                size: { value: 3, random: true },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: '#00d4ff',
                    opacity: 0.3,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 1.5,
                    direction: 'none',
                    random: true
                }
            },
            interactivity: {
                detect_on: 'canvas',
                events: {
                    onhover: { enable: true, mode: 'grab' },
                    onclick: { enable: true, mode: 'push' }
                }
            }
        });

        // ========== åˆçº¦é…ç½® ==========
        const CONTRACTS = {
            tEngine: '0xd9661D56659B80A875E42A51955434A0818581D8',
            dpToken: '0xf7C464c7832e59855aa245Ecc7677f54B3460e7d',
            debearPass: '0x29f2a6756E5B79C36Eb6699220CB56f7749C7514'
        };

        // T-Engine ABI
        const TENGINE_ABI = [
            'function enterPool(uint256 amount, address inviter)',
            'function claim()',
            'function userInfo(address) view returns (uint256 totalShares, uint256 claimedShares, uint256 lastClaimEpoch, uint256 pendingRewards)',
            'function totalDeposited() view returns (uint256)',
            'function totalClaimed() view returns (uint256)',
            'function deployTime() view returns (uint256)',
            'function getCurrentEpoch() view returns (uint256)',
            'function calculateClaimable(address user) view returns (uint256)'
        ];

        const TOKEN_ABI = [
            'function approve(address spender, uint256 amount) external returns (bool)',
            'function balanceOf(address account) external view returns (uint256)',
            'function allowance(address owner, address spender) external view returns (uint256)'
        ];

        let provider, signer, userAddress;
        let updateInterval, tengineCountdownInterval;
        let userDPBalance = '0';

        // ========== è¿æ¥é’±åŒ… ==========
        async function connectWallet() {
            try {
                const walletProvider = window.okxwallet || window.ethereum;
                if (!walletProvider) {
                    showMessage('è¯·å®‰è£… MetaMask æˆ– OKX Wallet', 'error');
                    return;
                }

                await walletProvider.request({ method: 'eth_requestAccounts' });
                
                const chainId = await walletProvider.request({ method: 'eth_chainId' });
                if (chainId !== '0x138de') {
                    await walletProvider.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x138de' }]
                    });
                }

                provider = new ethers.providers.Web3Provider(walletProvider);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();

                const shortAddr = userAddress.substring(0, 6) + '...' + userAddress.substring(38);
                document.getElementById('connectBtn').textContent = shortAddr;
                
                // ä¿å­˜è¿æ¥çŠ¶æ€
                localStorage.setItem('walletConnected', 'true');
                localStorage.setItem('walletAddress', userAddress);
                
                await refreshData();
                await refreshDPBalance();
                startRealtimeUpdate();
                showMessage('é’±åŒ…è¿æ¥æˆåŠŸï¼', 'success');
            } catch (error) {
                showMessage('è¿æ¥é’±åŒ…å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ£€æŸ¥å¹¶æ¢å¤é’±åŒ…è¿æ¥
        async function checkWalletConnection() {
            const wasConnected = localStorage.getItem('walletConnected');
            if (!wasConnected) return;

            try {
                const walletProvider = window.okxwallet || window.ethereum;
                if (!walletProvider) return;

                // å…ˆæ£€æŸ¥ç½‘ç»œ
                const chainId = await walletProvider.request({ method: 'eth_chainId' });
                if (chainId !== '0x138de') {
                    console.log('Wrong network, need to switch to Berachain');
                    localStorage.removeItem('walletConnected');
                    localStorage.removeItem('walletAddress');
                    return;
                }

                const accounts = await walletProvider.request({ method: 'eth_accounts' });
                if (accounts && accounts.length > 0) {
                    provider = new ethers.providers.Web3Provider(walletProvider, 'any');
                    signer = provider.getSigner();
                    userAddress = await signer.getAddress();

                    const shortAddr = userAddress.substring(0, 6) + '...' + userAddress.substring(38);
                    document.getElementById('connectBtn').textContent = shortAddr;

                    localStorage.setItem('walletAddress', userAddress);

                    await refreshData();
                    await refreshDPBalance();
                    startRealtimeUpdate();
                } else {
                    localStorage.removeItem('walletConnected');
                    localStorage.removeItem('walletAddress');
                }
            } catch (error) {
                console.error('Error checking wallet connection:', error);
                localStorage.removeItem('walletConnected');
                localStorage.removeItem('walletAddress');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥é’±åŒ…è¿æ¥
        window.addEventListener('load', () => {
            checkWalletConnection();
        });

        // ========== è¿›å…¥çŸ¿æ±  ==========
        async function stake() {
            if (!signer) {
                showMessage('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }

            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„è´¨æŠ¼æ•°é‡', 'error');
                return;
            }

            try {
                const amountWei = ethers.utils.parseEther(amount);
                const token = new ethers.Contract(CONTRACTS.dpToken, TOKEN_ABI, signer);
                const tEngine = new ethers.Contract(CONTRACTS.tEngine, TENGINE_ABI, signer);

                // æ£€æŸ¥æˆæƒ
                const allowance = await token.allowance(userAddress, CONTRACTS.tEngine);
                if (allowance.lt(amountWei)) {
                    showMessage('æ­£åœ¨æˆæƒ...', 'info');
                    const approveTx = await token.approve(CONTRACTS.tEngine, ethers.constants.MaxUint256);
                    await approveTx.wait();
                }

                // é»˜è®¤é‚€è¯·äºº
                const inviter = '0xd8B4286c2f299220830f7228bab15225b4EA8379';

                showMessage('æ­£åœ¨è´¨æŠ¼...', 'info');
                const tx = await tEngine.enterPool(amountWei, inviter);
                await tx.wait();

                showMessage('è´¨æŠ¼æˆåŠŸï¼T-Engine å·²å¯åŠ¨', 'success');
                document.getElementById('stakeAmount').value = '';
                await refreshData();
                await refreshDPBalance();
            } catch (error) {
                showMessage('è´¨æŠ¼å¤±è´¥: ' + error.message, 'error');
            }
        }

        // T-Engineä¸æ”¯æŒå–å›ï¼Œéšè—æ­¤åŠŸèƒ½
        async function unstake() {
            showMessage('T-Engine ä¸æ”¯æŒå–å›è´¨æŠ¼ï¼Œä»…èƒ½é¢†å–å¥–åŠ±', 'error');
        }

        // ========== é¢†å–å¥–åŠ± ==========
        async function claimReward() {
            if (!signer) {
                showMessage('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }

            try {
                const tEngine = new ethers.Contract(CONTRACTS.tEngine, TENGINE_ABI, signer);
                
                showMessage('æ­£åœ¨é¢†å–å¥–åŠ±...', 'info');
                const tx = await tEngine.claim();
                await tx.wait();

                showMessage('å¥–åŠ±é¢†å–æˆåŠŸï¼', 'success');
                await refreshData();
            } catch (error) {
                showMessage('é¢†å–å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ========== åˆ·æ–°æ•°æ® ==========
        async function refreshData() {
            if (!provider || !userAddress) return;

            try {
                const tEngine = new ethers.Contract(CONTRACTS.tEngine, TENGINE_ABI, provider);

                // è·å–ç”¨æˆ·ä¿¡æ¯
                const userInfo = await tEngine.userInfo(userAddress);
                console.log('ğŸ” TEngine userInfo:', userInfo);

                // è§£ææ•°æ®
                let totalShares, claimedShares, lastClaimEpoch, pendingRewards;
                
                if (Array.isArray(userInfo)) {
                    totalShares = userInfo[0];
                    claimedShares = userInfo[1];
                    lastClaimEpoch = userInfo[2];
                    pendingRewards = userInfo[3];
                } else {
                    totalShares = userInfo.totalShares || userInfo[0];
                    claimedShares = userInfo.claimedShares || userInfo[1];
                    lastClaimEpoch = userInfo.lastClaimEpoch || userInfo[2];
                    pendingRewards = userInfo.pendingRewards || userInfo[3];
                }

                // å°è¯•è°ƒç”¨ calculateClaimable è·å–å®æ—¶å¯é¢†å–æ•°é‡
                let actualClaimable = pendingRewards;
                try {
                    const claimable = await tEngine.calculateClaimable(userAddress);
                    console.log('âœ… calculateClaimable:', ethers.utils.formatEther(claimable));
                    actualClaimable = claimable;
                } catch (calcError) {
                    console.log('ğŸ” åˆçº¦æœªæä¾› calculateClaimableï¼Œä½¿ç”¨æ‰‹åŠ¨è®¡ç®—æ¨¡å¼');
                    
                    // æ‰‹åŠ¨è®¡ç®—ï¼šé€’å‡é‡Šæ”¾æœºåˆ¶ 0.3%
                    try {
                        const currentEpoch = await tEngine.getCurrentEpoch();
                        console.log('ğŸ—“ï¸ currentEpoch:', currentEpoch.toString());
                        console.log('ğŸ—“ï¸ lastClaimEpoch:', lastClaimEpoch.toString());
                        
                        const epochDiff = currentEpoch.sub(lastClaimEpoch);
                        if (epochDiff.gt(0)) {
                            // é€’å‡é‡Šæ”¾è®¡ç®—
                            const remainingShares = totalShares.sub(claimedShares);
                            let currentRemaining = remainingShares;
                            let totalClaimable = ethers.BigNumber.from(0);
                            
                            for (let i = 0; i < Number(epochDiff); i++) {
                                const dayRelease = currentRemaining.mul(3).div(1000);
                                totalClaimable = totalClaimable.add(dayRelease);
                                currentRemaining = currentRemaining.sub(dayRelease);
                            }
                            
                            actualClaimable = totalClaimable;
                            console.log('ğŸ’° æ‰‹åŠ¨è®¡ç®—ç»“æœ:', ethers.utils.formatEther(actualClaimable));
                        }
                    } catch (epochError) {
                        console.error('âš ï¸ è·å– epoch å¤±è´¥:', epochError);
                    }
                }

                // è®¡ç®—æ˜¾ç¤ºæ•°æ®
                const stakedAmount = totalShares.div(4);
                const remainingShares = totalShares.sub(claimedShares).sub(actualClaimable);

                // æ›´æ–°é¡µé¢
                document.getElementById('myStake').textContent = parseFloat(ethers.utils.formatEther(stakedAmount)).toFixed(2) + ' DP';
                document.getElementById('myRemaining').textContent = parseFloat(ethers.utils.formatEther(remainingShares)).toFixed(2) + ' DP';
                document.getElementById('pendingReward').textContent = parseFloat(ethers.utils.formatEther(actualClaimable)).toFixed(4);
                document.getElementById('totalClaimed').textContent = parseFloat(ethers.utils.formatEther(claimedShares)).toFixed(2) + ' DP';
                
                // è·å–å…¨ç½‘æ•°æ®
                try {
                    const totalDeposited = await tEngine.totalDeposited();
                    document.getElementById('totalStake').textContent = parseFloat(ethers.utils.formatEther(totalDeposited)).toFixed(4) + ' DP';
                } catch (e) {
                    console.warn('è·å–å…¨ç½‘æ•°æ®å¤±è´¥:', e);
                }
                
                // è®¡ç®—ä¸‹æ¬¡é‡Šæ”¾å€’è®¡æ—¶
                try {
                    const [deployTimeBN, latestBlock] = await Promise.all([
                        tEngine.deployTime(),
                        provider.getBlock('latest')
                    ]);
                    const deployTime = Number(deployTimeBN.toString());
                    const now = Number(latestBlock.timestamp);
                    const SECONDS_PER_DAY = 86400;
                    const elapsedDays = Math.floor((now - deployTime) / SECONDS_PER_DAY);
                    const nextEpochStart = deployTime + (elapsedDays + 1) * SECONDS_PER_DAY;
                    startTengineCountdown(nextEpochStart);
                } catch (err) {
                    console.warn('å€’è®¡æ—¶è®¡ç®—å¤±è´¥:', err);
                    document.getElementById('tengineNextRelease').textContent = '--:--:--';
                }

            } catch (error) {
                console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
            }
        }

        // ========== æ˜¾ç¤ºæ¶ˆæ¯ ==========
        function showMessage(text, type = 'info') {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="alert ${type}">${text}</div>`;
            setTimeout(() => { messageDiv.innerHTML = ''; }, 5000);
        }

        // ========== ç§»åŠ¨ç«¯èœå•åˆ‡æ¢ ==========
        function toggleMobileMenu() {
            const hamburger = document.querySelector('.hamburger');
            const mobileMenu = document.querySelector('.mobile-menu');
            const overlay = document.querySelector('.mobile-menu-overlay');
            
            hamburger.classList.toggle('active');
            mobileMenu.classList.toggle('active');
            overlay.classList.toggle('active');
            
            if (mobileMenu.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        // ========== åˆ·æ–°DPä½™é¢ ==========
        async function refreshDPBalance() {
            if (!provider || !userAddress) return;
            
            try {
                const dpToken = new ethers.Contract(CONTRACTS.dpToken, TOKEN_ABI, provider);
                const balance = await dpToken.balanceOf(userAddress);
                userDPBalance = ethers.utils.formatEther(balance);
                document.getElementById('userDPBalance').textContent = parseFloat(userDPBalance).toFixed(2);
            } catch (error) {
                console.error('è·å–DPä½™é¢å¤±è´¥:', error);
            }
        }
        
        // ========== è®¾ç½®æœ€å¤§é‡ ==========
        function setMaxAmount() {
            if (!userAddress) {
                showMessage('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            document.getElementById('stakeAmount').value = userDPBalance;
        }
        
        // ========== å¯åŠ¨å®æ—¶æ›´æ–° ==========
        function startRealtimeUpdate() {
            if (updateInterval) clearInterval(updateInterval);
            updateInterval = setInterval(() => {
                refreshData();
                refreshDPBalance();
            }, 10000); // æ¯10ç§’åˆ·æ–°
        }
        
        // ========== T-Engine å€’è®¡æ—¶ ==========
        function startTengineCountdown(targetSec) {
            const el = document.getElementById('tengineNextRelease');
            if (!el) return;
            if (tengineCountdownInterval) clearInterval(tengineCountdownInterval);

            function pad(n) { return String(n).padStart(2, '0'); }
            function tick() {
                const nowMs = Date.now();
                const diffMs = targetSec * 1000 - nowMs;
                if (diffMs <= 0) {
                    el.textContent = '00:00:00';
                    clearInterval(tengineCountdownInterval);
                    // åˆ·æ–°æ•°æ®
                    setTimeout(refreshData, 1500);
                    return;
                }
                const totalSec = Math.floor(diffMs / 1000);
                const h = Math.floor(totalSec / 3600);
                const m = Math.floor((totalSec % 3600) / 60);
                const s = totalSec % 60;
                el.textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
            }

            tick();
            tengineCountdownInterval = setInterval(tick, 1000);
        }
    </script>
</body>
</html>
